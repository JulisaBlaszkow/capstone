
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>


</head>
<body>
<h1 id="hello"> hello</h1>
<canvas id="myChart"></canvas>
<!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.umd.js"></script>

<!--<script  src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>-->
<script  src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

</body>
</html>



<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.min.js"-->
<!--        integrity="sha512-v3ygConQmvH0QehvQa6gSvTE2VdBZ6wkLOlmK7Mcy2mZ0ZF9saNbbk19QeaoTHdWIEiTlWmrwAL4hS8ElnGFbA=="-->
<!--        crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->

<!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.min.js" integrity="sha512-v3ygConQmvH0QehvQa6gSvTE2VdBZ6wkLOlmK7Mcy2mZ0ZF9saNbbk19QeaoTHdWIEiTlWmrwAL4hS8ElnGFbA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->

<!--<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>-->

<!--<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>-->



<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.min.js" integrity="sha512-v3ygConQmvH0QehvQa6gSvTE2VdBZ6wkLOlmK7Mcy2mZ0ZF9saNbbk19QeaoTHdWIEiTlWmrwAL4hS8ElnGFbA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
<!--    <script>-->
<!--        const element = document.getElementById('hello');-->
<!--        setInterval(function () {console.log("hello")}, 1000);-->
<!--    </script>-->
<script>


    const ctx = document.getElementById('myChart');
    // const response = await fetch("http://localhost:3000/data");
    // const json = await response.json();
    // const response = {};
   // const json = {};
    // const generatelabels = (json) =>{
    //     return json.map(row => row.x)
    // };
    // const generatedata = (json) =>{
    //     return json.map(row => row.y)
    // };


    const data = {
        labels:[],
            datasets: [{
            label: 'y',
            data: []
        }
        ]
    }
    const config = {
        type: 'line',
        data: data,
            // {
            // labels:{},
            // datasets: [{
            //     label: 'y',
            //     data: {}
            // }
            //]
        //},
        options: {
            scales: {
                x: {
                    type: 'time',
                }
            },

            // animation: false,
            // scaleOverride: true,
            // scaleSteps: 10,
            // scaleStartValue: 0
        }
    };

   // let chart = null;
    let chart = new Chart(ctx, config);



    function addData(chart,label,data){
      chart.data.labels.push(label);
      chart.data.datasets.forEach((dataset) => {
          dataset.data.push(data);
      });
      chart.update();
    };
    let i = 0;
    setInterval(async function () {
        // if (chart != null) {
        //     chart.destroy();
        // }
        //chart.destroy();
        const response = await fetch("http://localhost:3000/data");
        const json = await response.json();
        //chart.data.datasets[0].data = json;
        const times = json.map(row => row.x);
        const vals = json.map(row => row.y);

        // const newlabel = (Math.random() + 1).toString(36).substring(7);
        // const newdata = Math.floor(Math.random() * (10 - 1 + 1)) + 1;
        const newlabel = times[i];
        const newdata = vals[i];
        times.shift();
        vals.shift();

        addData(chart,newlabel,newdata);
        i++;
        // console.log(times[3]);
        // console.log(vals[3]);
        // console.log(csv);
        // console.log(csvToChartData(csv));
        // console.log(json);


        //chart.update();

        // chart.data.datasets.forEach(dataset => {
        //     dataset.data = json.map(row => row.y);
        //     //console.log("hiii"+(json.map(row => row.y)));
        //     //dataset.data.shift();
        //
        // });
        //
        // chart.data.labels = (json.map(row => row.x));
        //console.log("hi"+(json.map(row => row.x)));
        //chart.data.labels.shift();

        //chart = new Chart(ctx, config);

        //patienceeee
   }, 3000);
</script>